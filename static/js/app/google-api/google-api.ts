///////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////

console.debug('[import:google-api.ts]');

///////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////

import assert from "../function/assert";

///////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////

interface Window {
    onGoogleApiClientLoad:Function;
    gapi:any;
}

declare let window:Window;

///////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////

export class GoogleApi {
    static get me():GoogleApi {
        if (this['_me'] === undefined) {
            this['_me'] = new GoogleApi();
        }
        return this['_me'];
    }

    constructor() {
        this.loadUrlTpl = 'https://apis.google.com/js/client.js?onload={0}';
    }

    get(callback:Function) {
        if (typeof window.gapi === 'undefined') {
            window.onGoogleApiClientLoad = function onGoogleApiClientLoad() {
                if (typeof callback === 'function') {
                    callback(assert(window.gapi, 'gapi'));
                }
            };
            $('body').append($('<script>', {
                src: this.loadUrlTpl.replace(
                    '{0}', window.onGoogleApiClientLoad.name)
            }));
        } else {
            callback(window.gapi);
        }
    }

    private loadUrlTpl:string;
}

///////////////////////////////////////////////////////////////////////////////

export default GoogleApi;

///////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////
